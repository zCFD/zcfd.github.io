<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Tutorial 2: Steady State RANS &#8212; zCFD User Guide v2023.06.5001-32-g1421e documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="icon" href="../_static/fav.png"/>
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="tutorial-2-steady-state-rans">
<h1>Tutorial 2: Steady State RANS<a class="headerlink" href="#tutorial-2-steady-state-rans" title="Permalink to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#control-dictionary-breakdown" id="id1">Control Dictionary Breakdown</a></p></li>
<li><p><a class="reference internal" href="#running-the-case" id="id2">Running the case</a></p></li>
<li><p><a class="reference internal" href="#post-processing" id="id3">Post processing</a></p></li>
<li><p><a class="reference internal" href="#paraview" id="id4">Paraview</a></p></li>
<li><p><a class="reference internal" href="#next-steps" id="id5">Next steps</a></p></li>
<li><p><a class="reference internal" href="#citations" id="id6">Citations</a></p></li>
</ul>
</nav>
<p>Following on from Tutorial 1, we now understand how to run a case on zCFD and visualise the results, we will begin to build up a test case to showcase some of the features of the solver. The case we will look at is the 30P30N aerofoil, which is a 2D multi element aerofoil, developed as an acoustic benchmark case. The geometry of which can be seen below:</p>
<a class="reference internal image-reference" href="../_images/30p30n.png"><img alt="30P 30N" src="../_images/30p30n.png" style="width: 600px;" /></a>
<p>Initially we will begin by obtaining a steady state RANS solution.</p>
<p>The required meshes and control dictionary can be found <a class="reference external" href="https://zcfd.zenotech.com/tutorials/2/30p30n_tutorial_2.zip" target="_blank">here</a>. The case has a 64,000 cells, and will run in less than 10 minutes on an NVIDIA RTX 3060.</p>
<p>This case is run as a steady state simulation, using an implicit time marching scheme. The Reynolds Averaged Navier-Stokes equations are solved using Menter’s SST turbulence model with wall functions.</p>
<section id="control-dictionary-breakdown">
<h2>Control Dictionary Breakdown<a class="headerlink" href="#control-dictionary-breakdown" title="Permalink to this heading">¶</a></h2>
<p>The setup for this case is very similar to the previous NACA0012 cases, but the control dictionary does feature some extra terms which can be useful for a more streamlined workflow.</p>
<section id="reference-variables">
<h3>Reference variables<a class="headerlink" href="#reference-variables" title="Permalink to this heading">¶</a></h3>
<p>At the top of the control file, the key variables for the case- Reynolds number, mach number, temperature etc… are all hard coded, and then referred to later in the script. In cases where you might want to run many simulations with slightly different values to change, this can be an effective way to ensure consistency with variables. Additionally this allows implicit values such as the reference velocity, and freestream mach to be calculated automatically in the script.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># create variables to assign main experimental parameters</span>
<span class="n">reynolds</span> <span class="o">=</span> <span class="mf">1.71e6</span>
<span class="n">mach</span> <span class="o">=</span> <span class="mf">0.17</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">295.56</span>
<span class="n">p</span> <span class="o">=</span> <span class="mi">101325</span>
<span class="n">R</span> <span class="o">=</span> <span class="mf">287.6</span>
<span class="n">gamma</span> <span class="o">=</span> <span class="mf">1.4</span>
<span class="n">reference_length</span> <span class="o">=</span> <span class="mf">0.457</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">5.5</span>

<span class="c1"># calculate implicit values</span>
<span class="n">rho</span> <span class="o">=</span> <span class="n">p</span> <span class="o">/</span> <span class="p">(</span><span class="n">R</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">gamma</span> <span class="o">*</span> <span class="n">R</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">mach</span>

<span class="c1"># assign each mesh zone to a boundary</span>
<span class="n">wall</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">]</span>
<span class="n">symmetry</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
<span class="n">farfield</span> <span class="o">=</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="scale">
<h3>Scale<a class="headerlink" href="#scale" title="Permalink to this heading">¶</a></h3>
<p>In this case a scaling is applied to convert the size of the mesh. The .h5 file has units of m, whereas the real world experiment was conducted in inches, therefore a scaling of 0.0254 is applied to convert between the two.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="c1"># scale the mesh to match the experimental data</span>
<span class="s1">&#39;scale&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mf">0.0254</span><span class="p">,</span><span class="mf">0.0254</span><span class="p">,</span><span class="mf">0.0254</span><span class="o">/</span><span class="mf">0.127</span><span class="p">],</span>
</pre></div>
</div>
</section>
<section id="inflow-vector">
<h3>Inflow vector<a class="headerlink" href="#inflow-vector" title="Permalink to this heading">¶</a></h3>
<p>In this case we want to simulate the aerofoil operating at an angle of attack of 4 degrees. Rather than rotating the mesh, it is easier to rotate the inflow vector relative to the mesh, an example of a Galilean transformation. The zutil function vector_from_angle() will automatically calculate the inflow vector given a velocity and angle of attack.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;IC_1&#39;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;temperature&#39;</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span>
    <span class="s1">&#39;pressure&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">,</span>
    <span class="s1">&#39;V&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="c1"># calculate the inflow vector based on the angle of attack</span>
        <span class="s1">&#39;vector&#39;</span> <span class="p">:</span> <span class="n">zutil</span><span class="o">.</span><span class="n">vector_from_angle</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">U</span><span class="p">),</span>
    <span class="p">},</span>
    <span class="s1">&#39;Reynolds No&#39;</span> <span class="p">:</span> <span class="n">reynolds</span><span class="p">,</span>
    <span class="s1">&#39;Reference Length&#39;</span> <span class="p">:</span> <span class="n">reference_length</span><span class="p">,</span>
    <span class="s1">&#39;turbulence intensity&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="s1">&#39;eddy viscosity ratio&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="s1">&#39;ambient turbulence intensity&#39;</span><span class="p">:</span> <span class="mf">1e-20</span><span class="p">,</span>
    <span class="s1">&#39;ambient eddy viscosity ratio&#39;</span><span class="p">:</span> <span class="mf">1e-20</span><span class="p">,</span>
<span class="p">},</span>
</pre></div>
</div>
</section>
<section id="transform">
<h3>Transform<a class="headerlink" href="#transform" title="Permalink to this heading">¶</a></h3>
<p>The lift and drag forces acting on a body are defined relative to the freestream flow, lift normal and drag parallel. In this case then where we have rotated the relative inflow vector to a specific angle of attack, it is also useful to rotate the force report by the same vector. The transformed forces will appear as <a href="#id7"><span class="problematic" id="id8">Ft_</span></a> terms in the report file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># define a function to rotate the output forces by the angle of attack</span>
<span class="k">def</span> <span class="nf">my_transform</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">):</span>
    <span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">]</span>
    <span class="n">v</span> <span class="o">=</span>  <span class="n">zutil</span><span class="o">.</span><span class="n">rotate_vector</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="n">alpha</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;v1&#39;</span> <span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;v2&#39;</span> <span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;v3&#39;</span> <span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]}</span>
</pre></div>
</div>
</section>
</section>
<section id="running-the-case">
<h2>Running the case<a class="headerlink" href="#running-the-case" title="Permalink to this heading">¶</a></h2>
<p>You can run the case as you did for Tutorial 1, but with the following <strong>run_zcfd</strong> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>zCFD<span class="o">)</span><span class="w"> </span>&gt;run_zcfd<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="w"> </span>-p<span class="w"> </span>30p30n_coarse.h5<span class="w"> </span>c<span class="w"> </span>30p30n_steady.py
</pre></div>
</div>
</section>
<section id="post-processing">
<h2>Post processing<a class="headerlink" href="#post-processing" title="Permalink to this heading">¶</a></h2>
<p>Start by launching a Jupyter server to examine the residuals in the 30p30n_steady_report.csv file. Running the first cell from the 30p30n_steady_report.ipynb notebook will plot the residuals for the continuity, momentum, and energy equations, as well as the residuals from the turbulence model.</p>
<p>You will notice that the density residuals for this stop converging at approximately 0.1 and continue to oscillate thereafter. This is a good indication that the simulation has unsteady effects, and needs to be run unsteady.</p>
<a class="reference internal image-reference" href="../_images/Figure_18.png"><img alt="Convergence" src="../_images/Figure_18.png" style="width: 600px;" /></a>
<p>Examining the force convergence history next, we are interested in the x and y forces, but transformed by the inflow vector, therefore the wall_Ftx and wall_Fty plots are of interest.</p>
<a class="reference internal image-reference" href="../_images/Figure_21.png"><img alt="Forces Ftx" src="../_images/Figure_21.png" style="width: 600px;" /></a>
<a class="reference internal image-reference" href="../_images/Figure_31.png"><img alt="Forces Fty" src="../_images/Figure_31.png" style="width: 600px;" /></a>
<p>Which show reasonable agreement with experimental results, and additionally that the forces are at least nearing convergence. The grid for this case is still extremely coarse, accounting for the differences in lift and drag coefficients.</p>
</section>
<section id="paraview">
<h2>Paraview<a class="headerlink" href="#paraview" title="Permalink to this heading">¶</a></h2>
<p>Opening Paraview, and loading in the <cite>30p30n_steady_wall.pvd</cite> results will allow you to view the aerofoil surface results:</p>
<a class="reference internal image-reference" href="../_images/Figure_41.png"><img alt="30p30n C_p shaded" src="../_images/Figure_41.png" style="width: 600px;" /></a>
<p>To get a continuous plot of cp against x/c you need to use a plot over sorted lines filter. To do this:</p>
<ol class="arabic simple">
<li><p>On the surface data apply a ‘cell data to point data’ filter.</p></li>
<li><p>On the cell data to point data apply a ‘slice’ filter, ensuring the slice uses a z normal, and is centred through the middle of the aerofoil</p></li>
<li><p>On the slice data apply a ‘plot on sorted lines’ filter and click apply. This will then bring up a new ‘line graph’ view.</p></li>
<li><p>Make sure to select all 3 segments in the composite data set dialogue box, then ensure only the cp variables are selected in the series parameters. Finally for the X Array name, select ‘Points_X’</p></li>
<li><p>Modify the style and markers until you are happy with the result.</p></li>
</ol>
<a class="reference internal image-reference" href="../_images/Figure_51.png"><img alt="cp against x/c" src="../_images/Figure_51.png" style="width: 600px;" /></a>
</section>
<section id="next-steps">
<h2>Next steps<a class="headerlink" href="#next-steps" title="Permalink to this heading">¶</a></h2>
<p>Since the cases looks as though it is an unsteady simulation, will will look at running the 30p30n case unsteady in the next tutorial.</p>
</section>
<section id="citations">
<h2>Citations<a class="headerlink" href="#citations" title="Permalink to this heading">¶</a></h2>
<p>Zhang, Yufei &amp; Chen, Haixin &amp; Wang, Kan &amp; Wang, Meng. (2017). Aeroacoustic Prediction of a Multi-Element Airfoil Using Wall-Modeled Large-Eddy Simulation. AIAA Journal. 55. 1-15. 10.2514/1.J055853.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/ZCFD_Mark_CMYK.png" alt="Logo"/>
            </a></p><h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../execution.html">Running zCFD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_guide/intro.html">Reference Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions.html">zCFD Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../meshutil.html">Mesh Conversion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../visualisation.html">Visualisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utilities.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pdf.html">PDF copy</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016-23, Zenotech Ltd.
      
      |
      <a href="../_sources/getting_started/quick_start_2.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-32675146-1']);
      _gaq.push(['_setDomainName', 'none']);
      _gaq.push(['_setAllowLinker', true]);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    
  </body>
</html>